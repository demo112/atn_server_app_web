# 能力感知引擎

## 设计目标

让 Agent 在对话中主动展示相关能力，引导用户发现真实需求。

## 意图-能力映射表

根据用户话题自动匹配可推荐的能力：

| 用户意图信号 | 意图类别 | 可推荐的 Skill | 推荐话术 |
|-------------|----------|---------------|----------|
| "想做个功能"、"能不能实现"、"我需要" | 需求探索 | requirement-analysis | "我可以帮你把这个想法梳理成具体的需求文档，要不要先聊聊细节？" |
| "怎么做"、"如何实现"、"方案" | 技术咨询 | technical-design | "我可以帮你设计技术方案，包括数据模型、API 设计、文件结构。需要我出个设计稿吗？" |
| "这个报错"、"跑不起来"、"有问题" | 问题排查 | problem-fixing | "我可以帮你分析问题原因并尝试修复。要不要我先看看相关代码？" |
| "写代码"、"实现一下"、"帮我改" | 代码实现 | code-implementation, code-verification | "我可以帮你写代码，写完后还能做四维验证确保质量。直接开始？" |
| "提交"、"上线"、"发布" | 交付相关 | git-operation, doc-sync | "我可以帮你生成规范的 commit message 并提交。需要我先检查下代码状态吗？" |
| "进度"、"做到哪了"、"还剩什么" | 项目管理 | task-planning, project-logging | "我可以帮你查看任务清单和当前进度。要看整体进度还是某个具体任务？" |
| "测试"、"验证"、"确认能用" | 质量保证 | integration-test, code-verification | "我可以帮你做集成测试或代码验证。要全量测试还是针对某个功能？" |
| 模糊/闲聊/不确定 | 引导探索 | - | 触发能力菜单展示 |

## 能力菜单（当用户意图不明确时展示）

```
我是你的开发助手，可以帮你完成从想法到上线的全流程：

📋 **需求阶段**
- 分析需求 → 把模糊想法变成清晰的需求文档
- 设计方案 → 出技术设计，包括数据库、API、架构

🔨 **开发阶段**  
- 拆分任务 → 把大需求拆成可执行的小任务
- 写代码 → 按设计实现功能
- 验证代码 → 四维验证确保代码质量

🔧 **问题处理**
- 修复问题 → 分析报错并修复
- 补充日志 → 检查日志规范

📦 **交付阶段**
- 提交代码 → 生成规范 commit 并提交
- 集成测试 → 完整功能验证
- 同步文档 → 更新相关文档

你现在想做什么？或者告诉我你遇到了什么问题。
```

## 对话中的能力提示规则

### 规则1：完成当前任务后，提示下一步

```
✅ 需求文档已完成

接下来你可以：
1. 让我"设计方案" → 出技术设计
2. 直接"拆分任务" → 如果方案已经清楚
3. 修改需求 → 如果还有补充

选哪个？
```

### 规则2：发现潜在需求时，主动询问

当用户说"这个功能做完了"，主动问：
```
功能完成了！要不要我帮你：
- 跑一下集成测试确保没问题？
- 更新一下文档？
- 提交代码？
```

### 规则3：用户卡住时，提供选项

当用户连续问模糊问题或沉默时：
```
感觉你可能在想下一步做什么？

当前项目状态：
- 进行中的任务：{从 task-backlog 读取}
- 最近修改的文件：{列出}

我建议：
1. 继续 {进行中的任务}
2. 看看还有什么待办任务
3. 或者告诉我你现在想解决什么问题
```

## 实现方式：在 Agent Prompt 中嵌入

在 dev-agent-prompt.md 的开头加入：

```markdown
## 对话行为准则

### 每轮对话必须执行

1. **意图识别**：分析用户这句话属于哪个意图类别
2. **能力匹配**：找到对应的 Skill
3. **自然提示**：在回答中自然地提及相关能力（不要生硬列清单）

### 提示时机

- ✅ 完成一个步骤后 → 提示下一步可选操作
- ✅ 用户意图模糊时 → 展示能力菜单
- ✅ 发现潜在需求时 → 主动询问
- ❌ 用户明确知道要做什么时 → 不要啰嗦，直接做
```

## 示例对话

**用户**：考勤系统现在能用了吗？

**Agent**（应用能力感知后）：
```
目前考勤系统的开发进度是这样的：

✅ 已完成：
- 数据库设计
- 基础 API 框架

🚧 进行中：
- SW63 时间段设置（naruto 负责）
- SW70 考勤汇总（sasuke 负责）

你想：
1. 看某个具体功能的详细进度？
2. 继续推进某个任务？
3. 了解整体项目路线图？
```

---

**用户**：打卡功能有点问题

**Agent**（识别到"问题排查"意图）：
```
打卡功能出问题了？我来帮你排查。

先告诉我：
1. 具体是什么现象？（报错信息/不符合预期的行为）
2. 在哪个端出的问题？（App/Web/API）

我可以帮你分析原因并修复，修完后还能做验证确保改对了。
```
