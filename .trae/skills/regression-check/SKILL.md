---
name: regression-check
description: 修复后的回归验证，确保原问题解决且不破坏已有功能。
---

# 回归验证

## 核心理念

> **修复不能引入新问题，必须有证据证明。**

回归验证是修复流程的最后一道防线，确保：
1. 原问题确实解决了
2. 已有功能没有被破坏
3. 代码与设计保持一致

---

## 激活方式

### 触发场景

- `problem-fixing` 完成修复后自动触发
- 用户说"验证一下"、"测试一下"
- 用户说"修好了吗"

### 激活确认

> **回归验证已启动** ✅
> 
> 正在验证修复结果...

---

## 工作流程

```
原问题验证 → 回归测试 → 设计一致性 → 编译检查 → 输出报告
```

### 阶段一：原问题验证

**目标**：确认原问题已解决。

#### 执行步骤

1. 回顾原问题描述
2. 执行复现步骤
3. 确认问题不再出现

#### 验证方式

| 问题类型 | 验证方式 |
|----------|----------|
| 编译错误 | `npm run build` 无报错 |
| 运行时错误 | 执行相关操作无报错 |
| 逻辑错误 | 执行测试用例通过 |
| 数据错误 | 检查数据输出正确 |

#### 输出

```markdown
**原问题验证**
- 问题描述：{原问题}
- 验证方式：{如何验证}
- 验证结果：✅ 已解决 / ❌ 未解决
- 证据：{命令输出/截图/日志}
```

---

### 阶段二：回归测试

**目标**：确认已有功能没有被破坏。

#### 执行步骤

1. 运行相关模块的测试
2. 运行全量测试（如果改动较大）
3. 检查测试结果

#### 测试命令

```bash
# 运行相关模块测试
npm test -- --grep "{模块名}"

# 运行全量测试
npm test

# 运行特定文件测试
npm test -- {测试文件路径}
```

#### 输出

```markdown
**回归测试**
- 测试范围：{模块/全量}
- 测试命令：`{命令}`
- 测试结果：✅ 全部通过 / ❌ 有失败
- 通过率：{X}/{Y}
- 失败用例：{如有}
```

---

### 阶段三：设计一致性

**目标**：确认修复后的代码与设计文档一致。

#### 执行步骤

1. 回顾设计锚定报告
2. 对比修复后的代码
3. 确认符合设计意图

#### 检查清单

- [ ] 修复符合原设计意图
- [ ] 没有改变 API 契约
- [ ] 没有改变数据模型
- [ ] 没有引入新行为

#### 输出

```markdown
**设计一致性**
- 设计文档：`{路径}`
- 一致性检查：✅ 一致 / ⚠️ 有偏差
- 偏差说明：{如有}
```

---

### 阶段四：编译检查

**目标**：确认代码编译通过，无 lint 错误。

#### 执行步骤

```bash
# 编译检查
npm run build

# Lint 检查
npm run lint

# 类型检查
npx tsc --noEmit
```

#### 输出

```markdown
**编译检查**
- 编译结果：✅ 通过 / ❌ 失败
- Lint 结果：✅ 通过 / ❌ 有警告/错误
- 类型检查：✅ 通过 / ❌ 有错误
```

---

### 阶段五：输出报告

**目标**：生成完整的回归验证报告。

#### 报告模板

```markdown
## 回归验证报告

### 验证结果：✅ 通过 / ❌ 未通过

### 详细结果

| 检查项 | 结果 | 说明 |
|--------|------|------|
| 原问题解决 | ✅/❌ | {说明} |
| 回归测试 | ✅/❌ | {通过率} |
| 设计一致性 | ✅/❌ | {说明} |
| 编译检查 | ✅/❌ | {说明} |

### 证据记录

#### 原问题验证
```
{命令输出}
```

#### 测试结果
```
{测试输出}
```

#### 编译结果
```
{编译输出}
```

### 结论

- ✅ 可以提交
- ❌ 需要继续修复，原因：{原因}
```

---

## 验证失败处理

| 失败项 | 处理 |
|--------|------|
| 原问题未解决 | 返回 problem-fixing 继续修复 |
| 回归测试失败 | 分析失败原因，可能引入了新问题 |
| 设计不一致 | 确认是否需要调整修复方案 |
| 编译失败 | 修复编译错误 |

---

## 与其他 Skill 的关系

| Skill | 关系 |
|-------|------|
| design-anchoring | 提供设计基准线 |
| problem-fixing | 本 Skill 验证其修复结果 |
| git-operation | 验证通过后进入提交流程 |
| code-verification | 可选，需要更深度验证时使用 |

---

## 后续流程

```
验证通过 → git-operation → 完成
验证失败 → problem-fixing → 重新验证
```
