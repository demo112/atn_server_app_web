---
name: problem-fixing
description: 分析错误并修复，带止损机制。
---

## 输入

- 错误信息/验证报告
- 相关代码文件

## 输出

- 修复后的代码

---

## 核心理念

1. **止损优先** - 防止越改越乱
2. **增量修复** - 最小改动
3. **记录历史** - 避免重复尝试

---

## 止损机制

### 3次规则

同一问题同一思路最多尝试3次，超过则通知人决定。

### 修复前评估

| 检查项 | 触发条件 | 处理 |
|--------|---------|------|
| 改动范围 | > 3个文件 | 建议回退 |
| 涉及核心逻辑 | 是 | 建议回退 |
| 之前改过同类问题 | 是 | 建议回退 |

任一触发 → 暂停，询问用户

---

## 流程

```
1. 分析错误
   - 错误类型
   - 错误位置
   - 可能原因
   
2. 评估修复方案
   - 改动范围
   - 是否涉及核心逻辑
   - 是否尝试过
   
3. 执行修复（如果评估通过）

4. 验证修复
   - 原问题解决？
   - 引入新问题？
   
5. 成功 → 回到code-logging重新走完整验证循环
   失败 → 记录方案 → 检查次数 → 继续或通知人
```

---

## 历史记录

```markdown
## 修复历史: {问题ID}

### 尝试1
- 方案：xxx
- 结果：失败
- 原因：xxx

### 尝试2
- 方案：xxx
- 结果：失败
- 原因：xxx

### 尝试3
- 方案：xxx
- 结果：失败
- 建议：回退到检查点，重新设计
```

---

## 异常处理

| 情况 | 处理 |
|------|------|
| 3次失败 | 通知人决定 |
| 设计问题 | 直接通知人，建议回退 |
| 无法定位问题 | 通知人 |