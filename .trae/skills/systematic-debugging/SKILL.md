---
name: systematic-debugging
description: "系统化调试方法论，四阶段根因分析。来源：obra/superpowers"
type: methodology
---

# 系统化调试

> 来源: [obra/superpowers](https://skills.sh/obra/superpowers/systematic-debugging)

随机修复浪费时间并产生新Bug。快速补丁掩盖底层问题。

**核心原则：在尝试修复之前，必须先找到根因。症状修复是失败。**

---

## 触发场景

- 遇到任何 **Bug** 或 **错误**
- 测试 **失败**
- 出现 **意外行为**
- 性能 **问题**
- 集成 **问题**

**特别适用于：**
- 多组件系统问题（CI → 构建 → 签名，API → 服务 → 数据库）
- 错误在调用栈深处
- 同一问题反复出现

---

## 铁律

### 没有根因调查，不能修复

如果你还没完成阶段一，你 **不能** 提出修复方案。

违反这条规则的字面意思就是违反调试的精神。

---

## 四阶段流程

必须按顺序完成每个阶段。

### 阶段一：根因调查

在尝试任何修复之前：

#### 1. 仔细阅读错误信息

- 完整的堆栈跟踪
- 错误代码
- 上下文信息

#### 2. 稳定复现

- 相同的输入
- 相同的环境
- 记录步骤

#### 3. 检查最近变更

- Git历史
- 配置变更
- 依赖更新

#### 4. 多组件系统收集证据

当系统有多个组件时（CI → 构建 → 签名，API → 服务 → 数据库）：

**在提出修复之前，添加诊断埋点：**

```
对于每个组件边界：
  - 记录进入组件的数据
  - 记录离开组件的数据
  - 验证环境/配置传播
  - 检查每层的状态
```

**示例（多层系统）：**

```typescript
// Layer 1: API 入口
console.log('=== API Request ===', { body: req.body, params: req.params });

// Layer 2: Service 层
console.log('=== Service Input ===', { userId, data });
console.log('=== Service Output ===', { result });

// Layer 3: Database 层
console.log('=== DB Query ===', { sql, params });
console.log('=== DB Result ===', { rows });
```

运行一次收集证据 → 分析证据确定失败组件 → 调查该特定组件

#### 5. 追踪数据流（反向追踪法）

当错误在调用栈深处时：

```
错误位置 → 谁调用了它？ → 数据从哪来？ → 源头在哪？
```

**不要从源头正向追踪**，从错误点反向追踪更高效。

---

### 阶段二：模式分析

在修复之前找到模式：

1. **找到工作示例** - 类似的能工作的代码
2. **对比参考** - 文档、规格
3. **识别差异** - 有什么不同？
4. **理解依赖** - 这依赖什么？

---

### 阶段三：假设与测试

科学方法：

1. **形成单一假设** - 一次一个理论
2. **最小化测试** - 最小的变更来验证
3. **继续前验证** - 确认或否定
4. **不知道时** - 询问、研究、实验

---

### 阶段四：实施

修复根因，而不是症状：

1. **创建失败测试用例** - 证明Bug存在
2. **实施单一修复** - 一次一个变更
3. **验证修复** - 测试通过，无回归
4. **如果修复不起作用** - 返回阶段一

#### 如果3+次修复失败：质疑架构

表明架构问题的模式：
- 同一区域持续出问题
- 修复产生新Bug
- 代码难以理解

停下来质疑基本面：
- 设计是否正确？
- 我们是否在解决正确的问题？
- 是否应该先重构？

**这不是假设失败 — 这是架构错误。** 在尝试更多修复之前与人类伙伴讨论。

---

## 红旗 - 停下来遵循流程

如果你发现自己在想：
- "我知道这是什么"
- "快速修复会起作用"
- "没时间调查"
- "让我先试试这个"

所有这些都意味着：**停下来。返回阶段一。**

### 人类伙伴的信号

当你看到这些反馈时，说明你做错了：

- "你试过什么了？"
- "根因是什么？"
- "为什么你认为这会起作用？"
- "停下来，先调查"

看到这些：**停下来。返回阶段一。**

---

## 常见合理化借口

| 借口 | 现实 |
|------|------|
| "问题很简单，不需要流程" | 简单问题也有根因。流程对简单Bug很快。 |
| "紧急情况，没时间走流程" | 系统化调试比猜测-检查的折腾更快。 |
| "先试试这个，然后再调查" | 第一次修复设定了模式。从一开始就做对。 |
| "我确认修复有效后再写测试" | 未测试的修复不会持久。先测试证明它。 |
| "一次多个修复节省时间" | 无法隔离什么起作用了。会导致新Bug。 |
| "参考太长，我会调整模式" | 部分理解保证Bug。完整阅读它。 |
| "我看到问题了，让我修复它" | 看到症状 ≠ 理解根因。 |
| "再试一次修复"（2+次失败后） | 3+次失败 = 架构问题。质疑模式，不要再修复。 |

---

## 快速参考

| 阶段 | 关键活动 | 成功标准 |
|------|----------|----------|
| 1. 根因 | 读错误、复现、检查变更、收集证据 | 理解什么和为什么 |
| 2. 模式 | 找工作示例、对比 | 识别差异 |
| 3. 假设 | 形成理论、最小测试 | 确认或新假设 |
| 4. 实施 | 创建测试、修复、验证 | Bug解决，测试通过 |

---

## 当流程揭示"无根因"

如果系统调查揭示问题确实是环境相关、时序依赖或外部因素：

1. 你已完成流程
2. 记录你调查了什么
3. 实施适当处理（重试、超时、错误消息）
4. 添加监控/日志以便未来调查

**但是：95% 的"无根因"案例是调查不完整。**

---

## 输出格式

### 调查报告模板

```markdown
## 问题调查报告

### 症状描述
{错误信息和表现}

### 复现步骤
1. {步骤1}
2. {步骤2}

### 根因分析
- **调查过程**：{做了什么调查}
- **发现**：{发现了什么}
- **根因**：{确定的根因}

### 修复方案
- **方案**：{具体修复方案}
- **验证方式**：{如何验证修复有效}

### 预防措施
{如何防止类似问题再次发生}
```

---

## 与其他 Skill 的关系

| Skill | 关系 |
|-------|------|
| problem-fixing | 本 Skill 是其根因调查的详细方法论 |
| code-verification | 修复后需要验证代码 |
| verification-before-completion | 声称修复前必须验证 |
