# Git 冲突处理规范

## 一、拉取规范

### 规则 P1: 工作前必须拉取
每天开始工作前、长时间离开后，必须先拉取：
```bash
git pull --rebase origin main
```

### 规则 P2: 拉取前确保干净
**禁止在有未提交变更时直接 pull**

| 场景 | 处理方式 |
|------|----------|
| 有未完成的修改 | 先 `git stash`，pull 后 `git stash pop` |
| 有已暂存的修改 | 先 commit 或 reset |
| 工作区干净 | 直接 pull |

### 规则 P3: 优先使用 rebase
```bash
git pull --rebase origin main
```

---

## 二、预防优先

- 通过模块分工避免冲突
- 开始改文件前先沟通
- 频繁 push，减少本地积压
- 每次开始工作前先 `git pull`

---

## 三、冲突处理

### 处理原则
- AI 分析冲突并提出解决方案
- **AI 判断必须完全基于 `.trae/specs/{feature}/requirements.md`**
- 禁止无依据猜测
- 用户确认后执行

### 复杂度分类

| 复杂度 | 条件 | AI 处理能力 |
|--------|------|-------------|
| **简单** | import 语句、格式差异、新增代码无交集 | ✅ 可自动处理 |
| **中等** | 同函数不同修改、配置文件、依赖版本 | ⚠️ 需确认后处理 |
| **复杂** | 业务逻辑冲突、架构变更、数据模型 | ❌ 需人工决策 |

### 处理方式

| 冲突类型 | 处理方式 |
|----------|----------|
| 简单冲突 | AI 自动合并，用户确认 |
| 中等冲突 | AI 列出选项，用户选择 |
| 复杂冲突 | 暂停，请求用户决策 |
| 无法判断 | 暂停，请求用户补充需求 |

### 解决后必须验证
```bash
# 检查残留标记
git --no-pager diff | grep -E "^(<<<<<<<|=======|>>>>>>>)"

# 编译验证
npm run build
```

**禁止用户自行解决代码冲突**

---

## 四、策略速查

| 场景 | 策略 |
|------|------|
| import 语句冲突 | 合并去重 |
| 双方新增不同功能 | 保留双方 |
| 同函数不同修改 | 合并逻辑（需确认） |
| 配置文件冲突 | 按环境合并（需确认） |
| 依赖版本冲突 | 取较新版本 |
| 一方删除一方修改 | 询问是否保留 |
| 业务逻辑冲突 | 人工决策 |

---

## 五、放弃解决

```bash
git rebase --abort  # 放弃 rebase
git merge --abort   # 放弃 merge
```
