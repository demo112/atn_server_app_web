# 开发实施指南

## 一、技术栈

### 核心技术

| 模块 | 技术 |
|------|------|
| Server | Node.js + Express + TypeScript |
| Web | React + TypeScript |
| App | React Native + TypeScript |
| 共享 | TypeScript 类型定义 |

### 数据层

| 类型 | 技术 | 部署 |
|------|------|------|
| 主数据库 | MySQL + Prisma | 腾讯云托管 |
| 缓存 | Redis | 腾讯云托管 |
| 消息队列 | BullMQ | 基于Redis |

### 基础设施

| 类型 | 技术 |
|------|------|
| 反向代理 | Nginx |
| 容器 | Docker |
| 包管理 | pnpm workspace |

---

## 二、代码规范

### 命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 变量/函数 | camelCase | `getUserInfo` |
| 常量 | UPPER_SNAKE_CASE | `MAX_RETRY_COUNT` |
| 类/类型 | PascalCase | `AttendanceRecord` |
| 文件 | kebab-case | `user-service.ts` |

### 文件组织

```
packages/server/src/
├── modules/           # 业务模块
│   ├── user/
│   │   ├── user.controller.ts
│   │   ├── user.service.ts
│   │   ├── user.dto.ts
│   │   └── user.test.ts
│   └── attendance/
├── common/            # 公共代码
│   ├── middleware/
│   ├── utils/
│   └── types/
└── config/            # 配置
```

### API规范

| 项目 | 规范 |
|------|------|
| 路径格式 | `/api/v1/{resource}` |
| 方法 | GET查询、POST创建、PUT更新、DELETE删除 |
| 响应格式 | `{ success: boolean, data?: T, error?: { code, message } }` |
| 错误码 | `ERR_{MODULE}_{TYPE}`，如 `ERR_USER_NOT_FOUND` |

---

## 三、开发流程

### 功能开发流程

```
需求 → 设计（人确认）→ 任务拆分 → 循环[编码→验证→提交] → 集成测试 → 交付
```

详见 `04-人机协作方法论.md`

### 分支策略

| 分支 | 用途 |
|------|------|
| main | 稳定版本 |
| feature/* | 功能开发 |

### 提交规范

```
<类型>(<范围>): <描述>

类型：feat/fix/docs/refactor/test
范围：模块名
```

---

## 四、部署方案

### 开发环境

```
本地 Docker Compose：
- MySQL（或连接腾讯云）
- Redis
- Server（热重载）
- Web（热重载）
```

### 测试环境

```
腾讯云：
- MySQL（托管）
- Redis（托管）
- Server（Docker）
- Web（Nginx静态）
```

### 生产环境

```
腾讯云：
- MySQL（托管，主从）
- Redis（托管，集群）
- Server（Docker，多实例）
- Web（CDN + Nginx）
- Nginx（反向代理 + 负载均衡）
```

---

## 五、业务模块

### 模块划分

| 模块 | 说明 | 负责人 |
|------|------|--------|
| user | 用户管理 | A |
| attendance | 考勤打卡 | B |
| schedule | 排班管理 | 待定 |
| report | 报表统计 | 待定 |
| device | 设备管理 | 待定 |
| org | 组织架构 | 待定 |

### 开发优先级

| 阶段 | 模块 | 目标 |
|------|------|------|
| P0 | user + attendance | 最小可用：能打卡 |
| P1 | schedule + report | 基础功能：能排班、能看报表 |
| P2 | device + org | 完整功能 |

---

## 六、环境配置

### 环境变量

```env
# 数据库
DATABASE_URL=mysql://user:pass@host:3306/db

# Redis
REDIS_HOST=host
REDIS_PORT=6379
REDIS_PASSWORD=xxx

# 应用
NODE_ENV=development|production
PORT=3000
JWT_SECRET=xxx
```

### Docker Compose（开发环境）

```yaml
version: '3.8'
services:
  server:
    build: ./packages/server
    ports:
      - "3000:3000"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_HOST=redis
    depends_on:
      - redis

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
```
