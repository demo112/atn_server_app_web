# 仓库架构讨论记录

## 讨论背景

需要确定 Server/App/Web 三端项目的组织方式。

---

## 核心问题：Monorepo vs Multi-repo

### 方案对比

| 维度 | Monorepo | Multi-repo |
|------|----------|------------|
| AI编码友好度 | ✅ 高 - AI可以看到全貌 | ❌ 低 - 只能看到单端 |
| 代码共享 | ✅ 容易 - 直接引用 | ❌ 麻烦 - 需要发布npm包 |
| 2人协作 | ✅ 简单 - 同一个仓库 | ❌ 复杂 - 多仓库同步 |
| 上下文管理 | ✅ 统一配置 | ❌ 分散配置 |

### 顾虑：项目规模

项目预计几十万行代码，全放一起会给AI带来上下文压力。

### 解决方案：Monorepo + 模块化隔离

- 物理上是 Monorepo（方便跨端协作）
- 逻辑上是隔离的（pnpm workspace）
- AI工作时聚焦单模块（通过上下文控制）

---

## 技术方案：pnpm workspace

### 什么是 pnpm workspace

在一个仓库里管理多个相关项目（包），统一依赖管理，支持内部包互相引用。

### 逻辑隔离的含义

模块之间有清晰的依赖边界：
- server 只能引用 shared
- web 只能引用 shared
- app 只能引用 shared
- 技术上强制，不是靠约定

### 依赖方向

```
server ──→ shared ←── web
              ↑
             app
```

---

## 最终结论

采用 **Monorepo + pnpm workspace** 架构：

```
attendance-system/
├── packages/
│   ├── server/           # 后端服务
│   ├── web/              # 管理后台
│   ├── app/              # 移动端
│   └── shared/           # 共享代码
├── docs/                 # 项目文档
├── pnpm-workspace.yaml
└── package.json
```

### 选择理由

1. 初创阶段，经常需要跨端改动
2. 2人团队，无需复杂权限隔离
3. 共享类型定义方便
4. 一套配置，维护成本低

---

## 当前项目评估

`attendance-system/` 已符合该架构：

- ✅ pnpm-workspace.yaml 配置正确
- ✅ 四个模块划分清晰（server/web/app/shared）
- ✅ 依赖关系正确（都依赖 shared，使用 `workspace:*`）
- ✅ TypeScript paths 配置了 `@attendance/*` 路径映射

### 待补充

- 各模块的 README.md（帮助AI理解模块职责）
- .trae 配置目录（Rules/Skills）
- shared 的实际内容（类型定义等）
