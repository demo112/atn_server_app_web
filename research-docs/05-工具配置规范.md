# 工具配置规范

## 一、层级关系

```
Rules（全局约束）→ 约束 Agent 和 Skill
Agent（工作流程）→ 调度 Skill
Skill（具体步骤）→ 执行任务
```

| 层级 | 职责 | 类比 |
|------|------|------|
| Rules | 全局约束，不可违背 | 公司制度 |
| Agent | 定义工作流程，调度Skill | 项目经理 |
| Skill | 执行具体步骤 | 操作手册 |

---

## 二、Rules 配置

### 项目规则（project_rules.md）

```markdown
# 项目规则

## 技术栈（待技术选型后填充）
- 后端：xxx
- 前端：xxx
- 数据库：xxx

## 代码规范
- 使用 TypeScript 严格模式
- 禁止使用 any 类型
- 所有函数必须有返回类型
- 变量命名：camelCase
- 常量命名：UPPER_SNAKE_CASE

## API规范
- 路径格式：/api/v1/{resource}
- 响应格式：{ success, data, error }
- 错误码格式：ERR_{MODULE}_{TYPE}

## 安全规范
- 禁止硬编码密钥
- 所有用户输入必须验证
- 敏感操作必须记录日志

## 日志规范
- 级别：ERROR/WARN/INFO/DEBUG
- 格式：[时间] [级别] [模块] [用户ID] 消息
- 禁止记录密码、token等敏感信息

## 提交规范
- 格式：<类型>(<范围>): <描述>
- 类型：feat/fix/docs/refactor/test

## 公共代码规则
- shared/*/common.* 文件：项目初期共同定义，修改前必须沟通
- AI 不得自行修改 common.* 文件
```

### 个人规则（user_rules.md）

每人配置不同，声明负责的模块：

```markdown
# 个人规则

## 负责模块
我负责 [user/attendance] 模块

## 命名空间
- 类型前缀：[User/Attendance]*
- API路径：/api/v1/[user/attendance]/*
- 目录：*/[user/attendance]/*

## 只能操作以下路径的文件
- packages/server/src/*/[user/attendance]/*
- packages/web/src/*/[user/attendance]/*
- packages/app/src/*/[user/attendance]/*
- packages/shared/src/types/[user/attendance].ts
- packages/shared/src/utils/[user/attendance].ts
```

---

## 三、Agent 配置

### 设计方案：一个主 Agent + 按需调用 Skill

**理由：**
- 多 Agent 切换增加复杂度
- 一个 Agent 保持上下文连贯
- 专业能力由 Skill 提供

### 主 Agent：fullstack-developer

```yaml
name: fullstack-developer
role: 全栈开发专家
trigger: 默认激活

workflow:
  1. 需求分析 → Skill(requirement-analysis)
  2. 技术设计 → Skill(technical-design) → 等待人确认
  3. 任务拆分 → Skill(task-planning)
  4. 循环执行任务：
     a. 代码实现 → Skill(code-implementation)
     b. 日志检查 → Skill(code-logging)
     c. 代码验证 → Skill(code-verification)
     d. 失败 → Skill(problem-fixing)（带止损）
     e. 文档同步 → Skill(doc-sync)
     f. Git提交 → Skill(git-operation)
  5. 全部完成 → Skill(integration-test)
  6. 项目日志 → Skill(project-logging)
  7. 交付

constraints:
  - 遵循 project_rules.md
  - 遵循 user_rules.md（命名空间限制）
  - 修改 common.* 文件前必须询问用户
```

---

## 四、Skill 配置

### Skill 清单

| Skill | 职责 | 输入 | 输出 |
|-------|------|------|------|
| requirement-analysis | 需求分析 | 模糊需求 | 需求文档 |
| technical-design | 技术设计 | 需求文档 | 设计文档 |
| task-planning | 任务拆分 | 设计文档 | 任务清单 |
| code-implementation | 代码实现 | 单个任务 | 代码文件 |
| code-logging | 日志检查/补充 | 代码 | 补充日志后的代码 |
| code-verification | 代码验证 | 代码 | 验证报告 |
| problem-fixing | 问题修复 | 错误信息 | 修复后的代码 |
| integration-test | 集成测试 | 完整功能 | 测试报告 |
| doc-sync | 文档同步 | 代码变更 | 更新后的文档 |
| git-operation | Git操作 | 变更内容 | 提交完成 |
| project-logging | 项目日志 | 事件 | 日志记录 |

### 关键 Skill 详细设计

#### task-planning（任务拆分）

解决粒度控制问题：

```markdown
## 拆分规则
每个任务必须满足：
- 改动文件 ≤ 5个
- 可独立验证
- 能用一句话描述
- 预计完成时间 < 15分钟

## 输出
TODO.md 任务清单

## 执行后
逐个执行，每完成一个：验证 → 通过则提交（检查点）
```

#### problem-fixing（问题修复）

实现止损机制：

```markdown
## 修复前评估
1. 改动范围 > 3个文件？
2. 涉及核心逻辑？
3. 之前改过同类问题？

任一为"是" → 建议回退，询问用户

## 修复次数限制
- 同一问题同一思路最多 3 次
- 超过 3 次 → 通知用户决定
```

#### code-logging（代码日志）

主动检查和补充日志：

```markdown
## 检查清单
- [ ] 函数入口（关键业务函数）
- [ ] 错误捕获（catch块）
- [ ] 外部服务调用
- [ ] 用户关键操作
- [ ] 状态变更

## 流程
扫描代码 → 识别场景 → 检查日志 → 缺失则补充
```

#### doc-sync（文档同步）

保持文档与代码同步：

```markdown
## 文档更新规则
| 触发事件 | 更新文档 |
|---------|---------|
| 需求分析完成 | requirements/*.md |
| 设计完成 | design/*.md |
| API变更 | api/*.md |
| 数据库变更 | database/*.md |
| 任务状态变化 | progress/*.md |
| 做出决策 | decisions/*.md |
| 遇到/解决问题 | issues/*.md |
| 代码提交 | changelog.md |
```

---

## 五、文档系统

### 核心原则

```
文档 = 人与AI之间的"共享记忆"
- 人通过文档告诉AI：要做什么
- AI通过文档告诉人：做了什么、为什么
```

### 文档分类

| 类别 | 文档 | 用途 | 读者 |
|------|------|------|------|
| 开发文档 | 需求、设计、API、数据库、进度 | 开发过程 | 开发者+AI |
| 运维文档 | 决策、问题、变更日志 | 追溯维护 | 开发者+AI |
| 项目文档 | 技术白皮书、价值文档 | 说明项目是什么 | 外部人员 |
| 学习文档 | 教程、最佳实践 | 帮助新人上手 | 新成员 |
| 宣传文档 | README、介绍 | 推广项目 | 公众 |
| 法律文档 | 开源协议 | 法律保护 | 所有人 |

### 文档结构

```
attendance-system/
├── docs/
│   │
│   │── # 开发文档
│   ├── requirements/       # 需求文档
│   ├── design/             # 设计文档
│   ├── api/                # API文档
│   ├── database/           # 数据库文档
│   ├── progress/           # 进度文档
│   │   ├── status.md       # 当前状态
│   │   ├── todo.md         # 待办
│   │   └── done.md         # 已完成
│   │
│   │── # 运维文档
│   ├── decisions/          # 决策文档
│   ├── issues/             # 问题文档
│   ├── changelog.md        # 变更日志
│   │
│   │── # 项目文档
│   ├── whitepaper.md       # 技术白皮书
│   └── value.md            # 项目价值文档
│
├── # 学习文档
├── tutorials/
│   ├── getting-started.md  # 快速开始
│   ├── development.md      # 开发指南
│   └── best-practices.md   # 最佳实践
│
├── # 宣传文档
├── README.md               # 项目介绍
├── CONTRIBUTING.md         # 贡献指南
│
├── # 法律文档
└── LICENSE                 # 开源协议（建议 MIT 或 Apache 2.0）
```

### 各文档说明

| 文档 | 内容 | 更新时机 |
|------|------|---------|
| whitepaper.md | 技术架构、设计理念、核心算法 | 架构变更时 |
| value.md | 项目解决什么问题、带来什么价值 | 项目定位变化时 |
| getting-started.md | 如何快速运行项目 | 环境变化时 |
| development.md | 如何参与开发 | 流程变化时 |
| best-practices.md | 开发最佳实践总结 | 积累经验时 |
| README.md | 项目一句话介绍、特性、截图 | 功能更新时 |
| CONTRIBUTING.md | 如何贡献代码 | 流程变化时 |
| LICENSE | 开源协议 | 一次性 |

---

## 六、MCP 配置

（待讨论后填充）

---

## 七、配置文件结构

```
attendance-system/.trae/
├── rules/
│   ├── project_rules.md
│   └── user_rules.md
├── skills/
│   ├── requirement-analysis/
│   │   └── SKILL.md
│   ├── technical-design/
│   │   └── SKILL.md
│   ├── task-planning/
│   │   └── SKILL.md
│   ├── code-implementation/
│   │   └── SKILL.md
│   ├── code-logging/
│   │   └── SKILL.md
│   ├── code-verification/
│   │   └── SKILL.md
│   ├── problem-fixing/
│   │   └── SKILL.md
│   ├── integration-test/
│   │   └── SKILL.md
│   ├── doc-sync/
│   │   └── SKILL.md
│   ├── git-operation/
│   │   └── SKILL.md
│   └── project-logging/
│       └── SKILL.md
└── agents/
    └── fullstack-developer.yaml
```
