# Skill: requirement-analysis 设计文档

## 一、基本信息

| 项目 | 内容 |
|------|------|
| 职责 | 将用户的模糊需求转化为结构化、可验证的需求文档 |
| 输入 | 用户口头描述 + 零星资料 |
| 输出 | `.trae/specs/{feature}/requirements.md` |

---

## 二、设计讨论记录

### 2026-01-29 讨论

**确定的要点：**
1. 输入：纯口头描述，可能有零星资料但不专业
2. 需要判断需求规模并拆分，大需求不能直接进入AI编码循环
3. 遇到模糊点：先列假设，让用户确认
4. 输出位置：`.trae/specs/{name}/requirements.md`
5. 参考Kiro Spec的requirements标准（User Story + AC + Out of Scope）

**问题与改进：**
- 初版过于简单，无法有效形成Skill能力
- 层次单薄，Agent难以激活相关领域能力
- 领域知识LLM本身具备，不需要在Skill里重复

---

## 三、方法论层

### 需求获取技术

| 技术 | 适用场景 | 本项目适用 |
|------|---------|-----------|
| 访谈 | 用户能说清需求 | ✅ 主要方式 |
| 原型 | 需求模糊，需可视化 | 部分适用 |
| 竞品分析 | 参考已有产品 | ✅ 参考海康云眸 |
| 用例分析 | 理清用户与系统交互 | ✅ 适用 |

### 5W1H分析框架

| 维度 | 问题 |
|------|------|
| Who | 谁用这个功能？ |
| What | 要做什么？ |
| When | 什么时候用？ |
| Where | 在哪里用？ |
| Why | 为什么需要？ |
| How | 怎么实现？ |

### INVEST原则（User Story质量标准）

| 原则 | 含义 | 检查问题 |
|------|------|---------|
| I - Independent | 独立 | 是否依赖其他Story？ |
| N - Negotiable | 可协商 | 细节是否可调整？ |
| V - Valuable | 有价值 | 对用户有什么意义？ |
| E - Estimable | 可估算 | 能评估工作量吗？ |
| S - Small | 小 | 一个迭代能完成吗？ |
| T - Testable | 可测试 | 有明确验收标准吗？ |

### 需求层次

| 层次 | 说明 | 示例 |
|------|------|------|
| 业务需求 | 为什么做这个系统 | 提高考勤管理效率 |
| 用户需求 | 用户要完成什么任务 | 员工要打卡 |
| 功能需求 | 系统要提供什么功能 | 打卡按钮、GPS定位 |
| 非功能需求 | 质量属性 | 响应时间<3秒 |

---

## 四、领域知识层

LLM本身具备考勤业务领域知识，此处仅记录项目特定约束：

- 参考产品：海康云眸
- 项目特定约束：（待补充）

---

## 五、操作指南层

### 流程

```
1. 理解需求
   - 用5W1H框架分析
   - 识别涉及的模块和端
   
2. 判断规模
   - 小/中：继续
   - 大：输出拆分方案 → 用户确认 → 为每个子需求重新执行
   
3. 识别模糊点
   - 列出假设
   - 用户确认假设
   
4. 输出需求文档
   - 按模板生成
   - 用INVEST原则自检
   - 用户确认
   
5. 完成，进入下一阶段（technical-design）
```

### 规模判断标准

| 规模 | 判断标准 | 处理 |
|------|---------|------|
| 小 | User Story ≤ 3，涉及模块 ≤ 2 | 直接输出 |
| 中 | User Story 4-8，涉及模块 ≤ 3 | 直接输出，标记复杂度 |
| 大 | User Story > 8 或 涉及模块 > 3 | 必须拆分 |

### 输出模板

```markdown
# Requirements: {Feature Name}

## Overview

（一段话说明要做什么，解决什么问题）

## User Stories

### Story 1: {标题}

As a [角色], I want [功能], so that [价值]

**Acceptance Criteria:**
- [ ] AC1: {具体可验证的标准}
- [ ] AC2: {具体可验证的标准}

## Constraints

- 性能要求：{如有}
- 安全要求：{如有}
- 技术约束：{如有}

## Out of Scope

- {明确不做的事项}

## Assumptions

以下假设已与用户确认：
- {假设1}

## References

#[[file:xxx]]

## Metadata

- 规模：小/中
- 涉及模块：{列表}
- 涉及端：Server / Web / App
```

---

## 六、边界处理层

### 异常情况

| 情况 | 处理 |
|------|------|
| 用户说不清需求 | 用5W1H引导提问 |
| 需求相互矛盾 | 列出矛盾点，让用户决策 |
| 需求超出技术能力 | 标记风险，建议替代方案 |
| 需求涉及已有功能 | 检查已有需求文档，识别依赖/冲突 |
| 用户不确认假设 | 暂停，不进入下一阶段 |

### 质量门禁

进入下一阶段前必须满足：
- [ ] 每个Story有至少1个AC
- [ ] AC可转为测试用例
- [ ] 无未确认的假设
- [ ] Out of Scope已明确
- [ ] 规模不超过"中"

---

## 七、SKILL.md 最终版

（设计完成后，提炼为正式的SKILL.md文件）
