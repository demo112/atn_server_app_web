# Skill: problem-fixing 设计文档

## 一、基本信息

| 项目 | 内容 |
|------|------|
| 职责 | 分析错误并修复，带止损机制 |
| 输入 | 错误信息 + 相关代码 |
| 输出 | 修复后的代码 |

---

## 二、设计讨论记录

### 2026-01-29 讨论

**问题：** AI容易钻牛角尖，越改越乱。

**解决方案：** 止损机制
- 同一问题同一思路最多3次
- 超过3次通知人决定
- 记录历史方案避免重复

**修复前评估：**
1. 改动范围 > 3个文件？
2. 涉及核心逻辑？
3. 之前改过同类问题？

任一为"是" → 建议回退，询问用户

**人决定选项：**
- 同意回退 → 回退到检查点，重新设计
- 提供新思路 → 按新思路尝试
- 再试一次 → 继续

---

## 三、方法论层

### 问题分类

| 类型 | 特征 | 处理 |
|------|------|------|
| 语法错误 | 编译失败 | 直接修复 |
| 逻辑错误 | 测试失败 | 分析后修复 |
| 设计错误 | 多处关联 | 建议回退 |
| 需求理解错误 | 功能不符 | 返回需求阶段 |

### 修复策略

| 策略 | 适用场景 |
|------|---------|
| 局部修复 | 问题明确，范围小 |
| 重写 | 代码混乱，局部修复成本高 |
| 回退 | 问题涉及设计层面 |

---

## 四、领域知识层

常见错误类型：
- TypeScript类型错误
- 运行时异常
- API响应不符
- 数据库操作失败

---

## 五、操作指南层

### 流程

```
收到错误
    ↓
分析错误（类型、位置、原因）
    ↓
评估修复方案
    ├── 触发止损条件 → 通知人决定
    │                    ├── 回退
    │                    ├── 新思路
    │                    └── 继续
    └── 未触发 → 执行修复
                    ↓
                验证修复
                    ├── 成功 → 完成
                    └── 失败 → 记录方案
                                ↓
                            检查次数
                                ├── < 3 → 换思路再试
                                └── ≥ 3 → 通知人决定
```

### 历史记录模板

```markdown
## 修复历史: {问题描述}

### 尝试1 - {时间}
- 方案：xxx
- 改动：file1, file2
- 结果：失败
- 原因：xxx

### 尝试2 - {时间}
- 方案：xxx
- 改动：file1
- 结果：失败
- 原因：xxx

### 结论
已尝试3次，建议回退到 commit {hash}
```

---

## 六、边界处理层

| 情况 | 处理 |
|------|------|
| 3次失败 | 通知人，提供选项 |
| 设计问题 | 直接通知人，建议回退 |
| 无法定位问题 | 通知人，提供已知信息 |
| 修复引入新问题 | 算作失败，计入次数 |

---

## 七、SKILL.md 最终版

（设计完成后，提炼为正式的SKILL.md文件）
