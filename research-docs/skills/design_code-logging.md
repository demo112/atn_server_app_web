# Skill: code-logging 设计文档

## 一、基本信息

| 项目 | 内容 |
|------|------|
| 职责 | 主动检查和补充代码日志 |
| 输入 | 代码文件 |
| 输出 | 补充日志后的代码 |

---

## 二、设计讨论记录

### 2026-01-29 讨论

**为什么需要单独Skill：**
- 仅靠Rules约束容易因上下文遗漏
- 需要主动扫描和检查

**检查清单：**
- 函数入口（关键业务函数）
- 错误捕获（catch块）
- 外部服务调用
- 用户关键操作
- 状态变更

---

## 三、方法论层

### 日志设计原则

| 原则 | 说明 |
|------|------|
| 可追溯 | 能通过日志还原操作链路 |
| 可定位 | 出问题能快速定位 |
| 不泄露 | 不记录敏感信息 |
| 适度 | 不过多影响性能 |

### 日志级别使用

| 级别 | 场景 |
|------|------|
| ERROR | 错误、异常 |
| WARN | 警告、潜在问题 |
| INFO | 关键业务操作 |
| DEBUG | 调试信息 |

---

## 四、领域知识层

日志规范来自 `project_rules.md`：
- 格式：[时间] [级别] [模块] [用户ID] 消息
- 禁止记录敏感信息

---

## 五、操作指南层

### 流程

```
1. 扫描代码文件
2. 识别场景：
   - 函数定义 → 检查入口日志
   - try-catch → 检查错误日志
   - 外部调用 → 检查调用日志
   - 状态变更 → 检查变更日志
3. 检查是否已有日志
4. 缺失则补充
5. 输出更新后的代码
```

### 日志模板

```typescript
// 函数入口
logger.info('module', userId, '操作描述', { 关键参数 })

// 错误捕获
logger.error('module', userId, '错误描述', { error: err.message })

// 外部调用
logger.info('module', userId, '调用外部服务', { service, params })
```

---

## 六、边界处理层

| 情况 | 处理 |
|------|------|
| 无法确定模块名 | 从文件路径推断 |
| 无法获取用户ID | 使用 'system' 或 'anonymous' |
| 日志过多影响可读性 | 只在关键点添加 |

---

## 七、SKILL.md 最终版

（设计完成后，提炼为正式的SKILL.md文件）
