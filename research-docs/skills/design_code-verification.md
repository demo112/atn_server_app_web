# Skill: code-verification 设计文档

## 一、基本信息

| 项目 | 内容 |
|------|------|
| 职责 | 验证代码正确性 |
| 输入 | 代码文件 + design.md + requirements.md |
| 输出 | 验证报告 |

---

## 二、设计讨论记录

### 2026-01-29 讨论

**核心理念：** 单一验证不可信，多重独立验证提升可信度。

**四维验证框架：**
| 维度 | 目的 | 方法 |
|------|------|------|
| 契约验证 | 形式化需求 | 属性测试、前后置条件 |
| 自洽性验证 | 内部逻辑一致 | 类型系统、运行时断言 |
| 对抗性验证 | 抵抗攻击 | 模糊测试、变异测试 |
| 交叉验证 | 多视角一致 | 独立审查、需求重述 |

**人的角色：** 不需要判断代码对不对，只需确认需求理解和在分歧点决策。

---

## 三、方法论层

### 验证层次

| 层次 | 验证内容 | 工具 |
|------|---------|------|
| 静态 | 类型、语法 | TypeScript |
| 单元 | 函数逻辑 | Jest/Vitest |
| 集成 | 模块交互 | 集成测试 |
| 契约 | 与设计一致 | 自定义检查 |

### 可信度评分

| 等级 | 分数 | 含义 |
|------|------|------|
| A | 90-100 | 高可信度 |
| B | 80-89 | 良好 |
| C | 70-79 | 一般 |
| D | 60-69 | 较低 |
| F | <60 | 不可信 |

---

## 四、领域知识层

验证工具：
- TypeScript - 类型检查
- Jest/Vitest - 单元测试
- Prisma validate - 数据模型验证

---

## 五、操作指南层

### 流程

```
1. 静态检查
   - tsc --noEmit
   - eslint
   
2. 单元测试
   - pnpm test
   
3. 契约检查
   - API路径与design.md一致
   - 类型定义与design.md一致
   
4. 计算可信度
   - 各项检查加权评分
   
5. 输出验证报告
```

### 验证报告模板

```markdown
# 验证报告: {Task/Feature}

## 结果: 通过/失败

## 检查项

| 检查 | 结果 | 详情 |
|------|------|------|
| 类型检查 | ✅/❌ | |
| 单元测试 | ✅/❌ | X/Y通过 |
| 设计一致性 | ✅/❌ | |

## 问题（如有）

1. 问题描述
2. 问题描述

## 可信度

- 分数：X/100
- 等级：X
- 风险点：xxx
```

---

## 六、边界处理层

| 情况 | 处理 |
|------|------|
| 验证失败 | 输出报告，触发problem-fixing |
| 无法自动验证 | 标记，建议人工确认 |
| 测试覆盖不足 | 标记风险，降低可信度 |
| 验证超时 | 记录，继续其他检查 |

---

## 七、SKILL.md 最终版

（设计完成后，提炼为正式的SKILL.md文件）
