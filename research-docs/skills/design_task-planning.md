# Skill: task-planning 设计文档

## 一、基本信息

| 项目 | 内容 |
|------|------|
| 职责 | 将设计文档转化为有序的、可独立验证的任务清单 |
| 输入 | `.trae/specs/{feature}/design.md` |
| 输出 | `.trae/specs/{feature}/tasks.md` |

---

## 二、设计讨论记录

### 2026-01-29 讨论

**核心问题：** design已有文件变更清单，task-planning还做什么？

**答案：** 把文件变更清单转化为**有序的、可独立验证的执行单元**。

**设计 vs 任务：**
| 设计文档 | 任务清单 |
|---------|---------|
| 说"要改什么" | 说"按什么顺序改" |
| 文件粒度 | 可能更细或更粗 |
| 静态描述 | 可执行、可勾选 |

**任务的关键属性：**
- 原子性：一个任务做一件事
- 独立验证：完成后能单独测试
- 有序性：任务之间有依赖顺序
- 检查点：每个任务完成后可提交

**推荐拆分策略：按层拆**
```
1. 数据模型（Prisma schema）
2. 类型定义（shared types）
3. 服务层（service）
4. 接口层（controller/routes）
5. 前端组件
6. 集成联调
```

---

## 三、方法论层

### 任务拆分策略

| 策略 | 适用场景 | 优点 |
|------|---------|------|
| 按文件拆 | 文件之间独立 | 简单直接 |
| 按功能拆 | 多文件紧密相关 | 功能完整 |
| 按层拆 | 全栈功能 | 每层可验证 |

### 任务粒度判断

| 指标 | 标准 |
|------|------|
| 文件数 | ≤ 5个 |
| 时间 | < 15分钟 |
| 描述 | 一句话能说清 |
| **核心** | 完成后能运行验证 |

### 任务依赖原则

```
数据层 → 类型层 → 服务层 → 接口层 → 前端层 → 集成层
```

后层依赖前层，不能跳跃。

---

## 四、领域知识层

依赖项目结构：
- `packages/server/prisma/` - 数据模型
- `packages/shared/src/types/` - 共享类型
- `packages/server/src/modules/` - 服务和接口
- `packages/web/src/` - Web前端
- `packages/app/src/` - App前端

---

## 五、操作指南层

### 流程

```
1. 读取设计文档
2. 提取文件变更清单
3. 按层分组
4. 确定依赖顺序
5. 为每个任务定义验证方式
6. 输出任务清单
7. 完成（无需人确认，直接进入执行）
```

### 输出模板

```markdown
# Tasks: {Feature Name}

## 概览

- 总任务数：N
- 预计总时间：X分钟
- 涉及模块：xxx

## 任务清单

### 阶段1：数据层

- [ ] Task 1: 创建数据模型
  - 文件: packages/server/prisma/schema.prisma
  - 内容: 添加Xxx模型
  - 验证: `npx prisma validate`
  - 预计: 5分钟

### 阶段2：类型层

- [ ] Task 2: 定义共享类型
  - 文件: packages/shared/src/types/xxx.ts
  - 内容: CreateXxxDto, XxxResponse
  - 验证: `pnpm -F shared build`
  - 依赖: Task 1
  - 预计: 5分钟

### 阶段3：服务层

- [ ] Task 3: 实现服务层
  - 文件: packages/server/src/modules/xxx/xxx.service.ts
  - 内容: XxxService类，create/find方法
  - 验证: 单元测试通过
  - 依赖: Task 2
  - 预计: 10分钟

### 阶段4：接口层

- [ ] Task 4: 实现API接口
  - 文件: packages/server/src/modules/xxx/xxx.controller.ts
  - 内容: POST/GET路由
  - 验证: API可调用
  - 依赖: Task 3
  - 预计: 10分钟

### 阶段5：前端层

- [ ] Task 5: 实现页面组件
  - 文件: packages/web/src/pages/xxx/XxxPage.tsx
  - 内容: 页面UI和逻辑
  - 验证: 页面可渲染
  - 依赖: Task 4
  - 预计: 15分钟

### 阶段6：集成

- [ ] Task 6: 集成联调
  - 内容: 前后端联调测试
  - 验证: 完整功能可用
  - 依赖: Task 5
  - 预计: 10分钟

## 检查点

| 任务完成后 | 操作 |
|-----------|------|
| 每个任务 | 验证通过 → git commit |
| 全部完成 | 集成测试 → git push |
```

---

## 六、边界处理层

| 情况 | 处理 |
|------|------|
| 设计文件变更清单不完整 | 返回technical-design补充 |
| 任务粒度过大 | 继续拆分 |
| 任务之间有循环依赖 | 重新规划顺序 |
| 涉及多人协作的文件 | 标记，提醒沟通 |

### 质量门禁

输出前检查：
- [ ] 每个任务有明确的文件和内容
- [ ] 每个任务有验证方式
- [ ] 依赖关系无循环
- [ ] 任务粒度符合标准

---

## 七、SKILL.md 最终版

（设计完成后，提炼为正式的SKILL.md文件）
