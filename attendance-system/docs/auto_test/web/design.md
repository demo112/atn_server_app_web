# Design: Webç«¯æµ‹è¯•è¦†ç›–æå‡æ–¹æ¡ˆ

## éœ€æ±‚æ˜ å°„

åŸºäº `requirements.md` çš„å…¨æ¨¡å—åˆ†æï¼Œæœ¬æ–¹æ¡ˆæ‰©å±•äº†æµ‹è¯•èŒƒå›´ä»¥è¦†ç›– Auth, Attendance, Organization, Statistics å››å¤§æ ¸å¿ƒé¢†åŸŸã€‚

| æ¨¡å— | å…³é”®éœ€æ±‚/ç›²åŒº | ä¼˜å…ˆçº§ | æµ‹è¯•ç±»å‹ | å®ç°ç­–ç•¥ |
|------|--------------|--------|----------|----------|
| **Auth** | Loginåè®®ã€é”™è¯¯åé¦ˆ | High | Integration | MSW Mock 401/403 |
| **Auth** | æƒé™è·¯ç”±å®ˆå« | High | Integration | æ¨¡æ‹Ÿä¸åŒè§’è‰²è®¿é—®å—é™è·¯ç”± |
| **Attendance** | **Leave (è¯·å‡)**: ä½™é¢/è·¨å¤©æ ¡éªŒ | High | Integration | æ¨¡æ‹Ÿæäº¤éæ³•æ—¥æœŸèŒƒå›´ï¼ŒéªŒè¯å‰ç«¯æ‹¦æˆª |
| **Attendance** | **Correction (è¡¥å¡)**: å®¡æ‰¹æµè½¬ | High | Integration | æ¨¡æ‹Ÿ "æäº¤->æ‹’ç»->å†æäº¤" çŠ¶æ€å˜åŒ– |
| **Attendance** | **Schedule (æ’ç­)**: æ‰¹é‡è¾¹ç•Œ | Medium | Unit/Integration | éªŒè¯æ•°ç»„è¾¹ç•Œå’Œæ—¥æœŸåˆæ³•æ€§ |
| **Org** | **Dept**: æ ‘æ“ä½œå¾ªç¯å¼•ç”¨ | High | Unit/Component | æµ‹è¯• Tree ç»„ä»¶çš„æ‹–æ‹½/é€‰æ‹©é€»è¾‘ |
| **Org** | **Employee**: ç¦»èŒæƒé™ | High | E2E/Integration | æ¨¡æ‹Ÿç¦»èŒçŠ¶æ€ä¸‹çš„ API è°ƒç”¨ |
| **Stats** | æŠ¥è¡¨æ—¥æœŸèŒƒå›´ | Low | Component | éªŒè¯æ—¥æœŸé€‰æ‹©å™¨çš„å¿«æ·é”®é€»è¾‘ |

## æµ‹è¯•æ¶æ„è®¾è®¡

### 1. æŠ€æœ¯æ ˆ (ä¿æŒä¸å˜)
- Vitest, React Testing Library, MSW

### 2. ç›®å½•ç»“æ„è§„èŒƒ (æ‰©å±•)

```
packages/web/src/
â”œâ”€â”€ __tests__/
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ auth/            # Login, Guard
â”‚   â”‚   â”œâ”€â”€ attendance/
â”‚   â”‚   â”‚   â”œâ”€â”€ leave/       # è¯·å‡ç”³è¯·æµç¨‹
â”‚   â”‚   â”‚   â”œâ”€â”€ correction/  # è¡¥å¡æµç¨‹
â”‚   â”‚   â”‚   â””â”€â”€ schedule/    # æ’ç­ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ organization/
â”‚   â”‚   â”‚   â”œâ”€â”€ department/  # éƒ¨é—¨å¢åˆ æ”¹æŸ¥
â”‚   â”‚   â”‚   â””â”€â”€ employee/    # äººå‘˜ç®¡ç†
â”‚   â”‚   â””â”€â”€ statistics/      # æŠ¥è¡¨æŸ¥çœ‹
â”‚   â””â”€â”€ utils/               # renderWithProviders, mockData
â”œâ”€â”€ components/
â”‚   â””â”€â”€ {Component}/
â”‚       â””â”€â”€ index.test.tsx   # ç»„ä»¶çº§å•å…ƒæµ‹è¯• (å¦‚ DepartmentTree)
â””â”€â”€ utils/
    â””â”€â”€ *.test.ts            # çº¯å‡½æ•°æµ‹è¯• (å¦‚ date-utils)
```

### 3. å…³é”®æµ‹è¯•ç­–ç•¥

#### 3.1 ç»„ç»‡æ¶æ„ (Tree Structure)
- **éš¾ç‚¹**: æ ‘å½¢ç»“æ„çš„é€’å½’æ“ä½œå’Œå¾ªç¯å¼•ç”¨æ£€æµ‹ã€‚
- **ç­–ç•¥**: é‡ç‚¹æµ‹è¯• `DepartmentTree` ç»„ä»¶ã€‚
  - Mock ä¸€ä¸ª 3 å±‚æ·±åº¦çš„æ ‘ç»“æ„ã€‚
  - æµ‹è¯•å°†çˆ¶èŠ‚ç‚¹ç§»åŠ¨åˆ°å­èŠ‚ç‚¹çš„æ“ä½œ -> é¢„æœŸå¤±è´¥ã€‚
  - æµ‹è¯•åˆ é™¤ä¸­é—´èŠ‚ç‚¹ -> éªŒè¯çº§è”åˆ é™¤æç¤ºã€‚

#### 3.2 è€ƒå‹¤æµç¨‹ (State Machine)
- **éš¾ç‚¹**: å¤šçŠ¶æ€æµè½¬ (Pending -> Approved/Rejected)ã€‚
- **ç­–ç•¥**: ä½¿ç”¨ Integration Test æ¨¡æ‹Ÿå®Œæ•´æµç¨‹ã€‚
  - **Setup**: `renderWithProviders(<Page />)` with mocked API.
  - **Action**: æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’ (ç‚¹å‡»ã€è¾“å…¥ã€æäº¤)ã€‚
  - **Assert**: éªŒè¯ API è°ƒç”¨å‚æ•°ã€UI çŠ¶æ€å˜æ›´ (Toast, åˆ—è¡¨åˆ·æ–°)ã€‚
  - **Guard**: éªŒè¯éæ³•çŠ¶æ€æµè½¬ (å¦‚ç¼–è¾‘å·²æ’¤é”€è®°å½•) æ˜¯å¦è¢«æ‹¦æˆªã€‚

#### 3.3 ç»Ÿè®¡æŠ¥è¡¨ (Data Visualization)
- **éš¾ç‚¹**: Canvas/SVG å›¾è¡¨éš¾ä»¥æ–­è¨€å…·ä½“å†…å®¹ã€‚
- **ç­–ç•¥**:
  - **ä¸æµ‹è¯•** å›¾è¡¨åƒç´ çº§æ¸²æŸ“ã€‚
  - **æµ‹è¯•** æ•°æ®ä¼ é€’å‡†ç¡®æ€§ (Component Props)ã€‚
  - **æµ‹è¯•** ç­›é€‰æ¡ä»¶å˜åŒ–æ—¶è§¦å‘äº†æ­£ç¡®çš„ API è¯·æ±‚ (Mock Service Spy)ã€‚

#### 3.4 ç­æ¬¡ç®¡ç† (Shift Management)
- **éš¾ç‚¹**: åŠ¨æ€è¡¨å•ã€è·¨å¤©æ—¶é—´å¤„ç†ã€å¼•ç”¨å®Œæ•´æ€§ã€‚
- **ç­–ç•¥**:
  - **åŠ¨æ€è¡¨å•**: æ¨¡æ‹Ÿåˆ‡æ¢æ‰“å¡æ¬¡æ•°ï¼ŒéªŒè¯è¾“å…¥æ¡†æ•°é‡å˜åŒ–ã€‚
  - **è·¨å¤©é€»è¾‘**: æ„é€ è·¨å¤©æ—¶é—´æ•°æ® (22:00-06:00)ï¼ŒéªŒè¯ä¿å­˜æ—¶ä¸æŠ¥é”™ã€‚
  - **å¼•ç”¨ä¿æŠ¤**: Mock åˆ é™¤æ¥å£è¿”å› 409 Conflictï¼ŒéªŒè¯å‰ç«¯é”™è¯¯æç¤ºã€‚

## æ–‡ä»¶å˜æ›´æ¸…å•

| ä¼˜å…ˆçº§ | æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | çŠ¶æ€ |
|--------|----------|------|------|
| P0 | `src/test/utils.tsx` | ç»Ÿä¸€ Render å·¥å…· | âœ… å·²å®Œæˆ |
| P0 | `src/__tests__/integration/auth/AuthGuard.test.tsx` | è·¯ç”±æƒé™å®ˆå« | âœ… å·²å®Œæˆ |
| P0 | `src/__tests__/integration/attendance/leave.test.tsx` | è¯·å‡æµç¨‹ä¸æ ¡éªŒ | âœ… å·²å®Œæˆ |
| P0 | `src/__tests__/integration/attendance/shift.test.tsx` | ç­æ¬¡ç®¡ç† (å¤šæ®µ/è·¨å¤©) | ğŸŸ¡ è¿›è¡Œä¸­ |
| P1 | `src/__tests__/integration/organization/department.test.tsx` | éƒ¨é—¨ç®¡ç† | âœ… å·²å®Œæˆ |
| P1 | `src/__tests__/integration/attendance/correction.test.tsx` | è¡¥å¡æµç¨‹ | âœ… å·²å®Œæˆ |
| P1 | `src/__tests__/integration/statistics/statistics.test.tsx` | ç»Ÿè®¡æŠ¥è¡¨ | âœ… å·²å®Œæˆ |

## é£é™©ä¸åº”å¯¹

1. **Mock æ•°æ®é‡å¤§**: æ¶‰åŠå…¨æ¨¡å—ï¼Œéœ€è¦æ„å»ºä¸€å¥—å®Œæ•´çš„ Mock Data Factory (ä½¿ç”¨ `@faker-js/faker`).
2. **æµ‹è¯•è¿è¡Œé€Ÿåº¦**: éšç€ç”¨ä¾‹å¢åŠ ï¼ŒCI æ—¶é—´å˜é•¿ -> å¯ç”¨ Vitest å¹¶å‘æ‰§è¡Œï¼Œåˆ†ç¦» E2Eã€‚
