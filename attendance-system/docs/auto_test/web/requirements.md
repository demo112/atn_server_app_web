# [Web] æµ‹è¯•ç›²åŒºåˆ†ææŠ¥å‘Š

## ä¸€ã€åˆ†ææ¦‚è¦
- **åˆ†æèŒƒå›´**ï¼š`packages/web/src` (å…¨æ¨¡å—è¦†ç›–ï¼šAuth, Attendance, Department, Employee, Statistics)
- **ç°æœ‰æµ‹è¯•**ï¼š
  - é›†æˆæµ‹è¯•ï¼š`__tests__/integration/` (è¦†ç›–äº† Auth, Login)
  - å•å…ƒæµ‹è¯•ï¼š`utils/*.test.ts`, `schemas/__tests__/*.test.ts`
  - ç»„ä»¶æµ‹è¯•ï¼š`components/DepartmentSelect/*.test.tsx`
- **å‘ç°ç›²åŒº**ï¼š
  - **Auth**: åè®®å‹¾é€‰ã€é”™è¯¯åé¦ˆ (å·²éƒ¨åˆ†ä¿®å¤)
  - **Attendance**: 
    - **Leave (è¯·å‡)**: å‡æœŸä½™é¢æ ¡éªŒã€è¯·å‡æ—¶é•¿è®¡ç®—ã€è·¨å¤©è¯·å‡
    - **Correction (è¡¥å¡)**: è¡¥å¡æ¬¡æ•°é™åˆ¶ã€å®¡æ‰¹çŠ¶æ€æµè½¬
    - **Shift/Schedule (æ’ç­)**: ç­æ¬¡å†²çªã€è·¨å¤©ç­æ¬¡ã€è§„å¾‹æ’ç­
  - **Organization**:
    - **Department**: éƒ¨é—¨æ ‘çš„ç§»åŠ¨/åˆ é™¤ï¼ˆåŒ…å«å­éƒ¨é—¨æ—¶ï¼‰ã€å¾ªç¯å¼•ç”¨
    - **Employee**: ç”¨æˆ·ç»‘å®šçŠ¶æ€ã€ç¦»èŒå‘˜å·¥å¤„ç†
  - **Statistics**: å¤§æ•°æ®é‡æŠ¥è¡¨æ¸²æŸ“ã€æ—¥æœŸèŒƒå›´è¾¹ç•Œ

## äºŒã€æ–¹æ³•è®ºè¦†ç›–å®¡æŸ¥

### 2.1 ç­‰ä»·ç±»åˆ’åˆ†
**è¦†ç›–ç‡**ï¼šä¸­

| æ¨¡å— | è¾“å…¥é¡¹ | å·²è¦†ç›–ç­‰ä»·ç±» | é—æ¼ç­‰ä»·ç±» | é£é™©ç­‰çº§ |
|------|--------|-------------|-----------|----------|
| **Auth** | Login.username | æœ‰æ•ˆæ‰‹æœºå· | éæ‰‹æœºå·/é‚®ç®±ã€ç‰¹æ®Šå­—ç¬¦ | ğŸŸ¡ ä¸­ |
| **Auth** | Login.password | æœ‰æ•ˆå¯†ç  | ç©ºã€è¶…é•¿ | ğŸŸ¡ ä¸­ |
| **Leave** | Duration | (æœªæµ‹è¯•) | **è¶…è¿‡ä½™é¢**ã€**æœ€å°è¯·å‡å•ä½** (0.5h vs 0.1h) | ğŸ”´ é«˜ |
| **Leave** | DateRange | (æœªæµ‹è¯•) | **å¼€å§‹æ—¶é—´ > ç»“æŸæ—¶é—´**ã€è·¨å¹´ | ğŸ”´ é«˜ |
| **Shift** | Time | (æœªæµ‹è¯•) | **æ¬¡æ—¥æ—¶é—´** (å¦‚ 25:00 æˆ– æ¬¡æ—¥01:00) | ğŸŸ¡ ä¸­ |
| **Dept** | ParentId | (æœªæµ‹è¯•) | **ç§»åŠ¨åˆ°è‡ªå·±/å­éƒ¨é—¨ä¸‹** (å¾ªç¯) | ğŸ”´ é«˜ |

### 2.2 è¾¹ç•Œå€¼åˆ†æ
**è¦†ç›–ç‡**ï¼šä½

| æ¨¡å— | è¾¹ç•Œç±»å‹ | è¾¹ç•Œå€¼ | é£é™©ç­‰çº§ |
|------|----------|--------|----------|
| **Schedule** | æ‰¹é‡æ•°é‡ | 0, 1, Max, Max+1 | ğŸŸ¡ ä¸­ |
| **Schedule** | æ—¥æœŸ | è¿‡å»æ—¶é—´ã€æœªæ¥æé™å€¼ | ğŸŸ¡ ä¸­ |
| **Stats** | æŠ¥è¡¨å‘¨æœŸ | 1å¤©, 31å¤©, 365å¤© (æ€§èƒ½è¾¹ç•Œ) | ğŸŸ¡ ä¸­ |
| **Correction** | è¡¥å¡æ¬¡æ•° | å½“æœˆç¬¬1æ¬¡ -> ç¬¬Næ¬¡ (é™åˆ¶) | ğŸ”´ é«˜ |

### 2.3 çŠ¶æ€è½¬æ¢æµ‹è¯•
**å…³é”®ä¸šåŠ¡æµè½¬**ï¼š

**1. è¯·å‡/è¡¥å¡å®¡æ‰¹æµ (Leave/Correction)**
| å½“å‰çŠ¶æ€ | åŠ¨ä½œ | ç›®æ ‡çŠ¶æ€ | é¢„æœŸè¡Œä¸º | ç°çŠ¶ |
|----------|------|----------|----------|------|
| Pending | æ’¤é”€ | Canceled | å…è®¸ | â“ |
| Pending | å®¡æ‰¹é€šè¿‡ | Approved | å†™å…¥è€ƒå‹¤ç»“æœ | â“ |
| Pending | å®¡æ‰¹æ‹’ç» | Rejected | é‡Šæ”¾ä½™é¢ | â“ |
| Approved | æ’¤é”€ | Canceled | **æ˜¯å¦å…è®¸? (é”€å‡æµç¨‹)** | ç›²åŒº |

**2. å‘˜å·¥çŠ¶æ€ (Employee)**
| å½“å‰çŠ¶æ€ | åŠ¨ä½œ | ç›®æ ‡çŠ¶æ€ | é£é™©ç‚¹ |
|----------|------|----------|--------|
| åœ¨èŒ | ç¦»èŒ | ç¦»èŒ | **è´¦å·æƒé™æ˜¯å¦å³åˆ»å›æ”¶?** | ğŸ”´ é«˜ |
| ç¦»èŒ | å¤èŒ | åœ¨èŒ | å†å²è€ƒå‹¤æ•°æ®å…³è” | ğŸŸ¡ ä¸­ |

### 2.4 å†³ç­–è¡¨
**å¤æ‚é€»è¾‘åœºæ™¯**ï¼š

**è€ƒå‹¤ç»“æœè®¡ç®— (è™½ç„¶ä¸»è¦åœ¨åç«¯ï¼Œå‰ç«¯éœ€å±•ç¤º)**
| ç­æ¬¡ | æ‰“å¡æ—¶é—´ | è¯·å‡çŠ¶æ€ | é¢„æœŸç»“æœ |
|------|----------|----------|----------|
| 9:00 | 9:01 | æ—  | è¿Ÿåˆ° |
| 9:00 | 9:01 | å·²è¯·å‡(9:00-10:00) | æ­£å¸¸ |
| 9:00 | æ—  | æ—  | ç¼ºå¡ |
| 9:00 | æ—  | è±å…/èŠ‚å‡æ—¥ | æ­£å¸¸ |

### 2.5 åœºæ™¯æ³•
**æ ¸å¿ƒç”¨æˆ·è·¯å¾„**ï¼š

| åœºæ™¯ç±»å‹ | åœºæ™¯æè¿° | è¦†ç›–æƒ…å†µ |
|----------|----------|----------|
| **ä¸»æµç¨‹** | å‘˜å·¥ç™»å½• -> æŸ¥çœ‹æ’ç­ -> æäº¤è¯·å‡ -> ç®¡ç†å‘˜å®¡æ‰¹ -> æŸ¥çœ‹ç»“æœ | âœ— |
| **ä¸»æµç¨‹** | ç®¡ç†å‘˜ -> æ–°å¢éƒ¨é—¨ -> æ–°å¢å‘˜å·¥ -> ç»‘å®šè´¦å· -> æ’ç­ | âœ— |
| **å¼‚å¸¸æµç¨‹** | è¯·å‡æäº¤æ—¶ç½‘ç»œä¸­æ–­ -> é‡è¯• -> é˜²é‡å¤æäº¤ | âœ— |
| **å¼‚å¸¸æµç¨‹** | åˆ é™¤åŒ…å«å‘˜å·¥çš„éƒ¨é—¨ -> çº§è”å¤„ç†/æŠ¥é”™æç¤º | âœ— |

### 2.6 é”™è¯¯æ¨æµ‹
| é”™è¯¯æ¨¡å¼ | åœºæ™¯ | é£é™© |
|----------|------|------|
| **æ•°æ®ä¸€è‡´æ€§** | åœ¨åˆ—è¡¨é¡µæ“ä½œ(å¦‚å®¡æ‰¹)åï¼Œè¯¦æƒ…é¡µçŠ¶æ€æœªåˆ·æ–° | ğŸŸ¡ ä¸­ |
| **å¹¶å‘æ“ä½œ** | å¤šäººåŒæ—¶æŠ¢å æœ€åä¸€ä¸ªåé¢ (å¦‚ç‰¹å®šæ’ç­) | ğŸŸ¢ ä½ |
| **æƒé™è¶Šæƒ** | æ™®é€šå‘˜å·¥é€šè¿‡ URL è®¿é—® `/attendance/settings` | ğŸ”´ é«˜ |
| **å¤§æ•°å±•ç¤º** | ç»Ÿè®¡æ—¶é•¿è¶…è¿‡ 9999 å°æ—¶ UI é”™ä½ | ğŸŸ¢ ä½ |

## ä¸‰ã€è¡¥å……ç”¨ä¾‹å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»è¡¥å……ï¼‰

**ç”¨ä¾‹1ï¼šè¯·å‡æ—¶é—´é€»è¾‘æ ¡éªŒ (Leave)**
- **ç›®çš„**ï¼šé˜²æ­¢æ— æ•ˆçš„è¯·å‡æ•°æ®æäº¤
- **æ­¥éª¤**ï¼š
  1. é€‰æ‹©è¯·å‡ç±»å‹
  2. è®¾ç½®å¼€å§‹æ—¶é—´ > ç»“æŸæ—¶é—´
  3. è®¾ç½®æ—¶é•¿ > å‰©ä½™ä½™é¢
- **é¢„æœŸ**ï¼šå‰ç«¯å³æ—¶æ ¡éªŒå¹¶é˜»æ­¢æäº¤

**ç”¨ä¾‹2ï¼šéƒ¨é—¨æ ‘å¾ªç¯ç§»åŠ¨æ ¡éªŒ (Department)**
- **ç›®çš„**ï¼šé˜²æ­¢ç»„ç»‡æ¶æ„æ•°æ®æŸå
- **æ­¥éª¤**ï¼šå°è¯•å°† "ç ”å‘éƒ¨" æ‹–åŠ¨åˆ° "ç ”å‘ä¸€éƒ¨" (å…¶å­éƒ¨é—¨) ä¸‹
- **é¢„æœŸ**ï¼šå‰ç«¯ç¦æ­¢æ‹–æ”¾æˆ–æäº¤æŠ¥é”™

**ç”¨ä¾‹3ï¼šè¡¥å¡å®¡æ‰¹çŠ¶æ€æµè½¬ (Correction)**
- **ç›®çš„**ï¼šéªŒè¯å®¡æ‰¹é—­ç¯
- **æ­¥éª¤**ï¼š
  1. å‘˜å·¥æäº¤è¡¥å¡
  2. ç®¡ç†å‘˜æ‹’ç»
  3. å‘˜å·¥æŸ¥çœ‹çŠ¶æ€ (Rejected)
  4. å‘˜å·¥å†æ¬¡æäº¤ (New Pending)

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

**ç”¨ä¾‹4ï¼šå‘˜å·¥ç¦»èŒæƒé™å›æ”¶**
- **æ­¥éª¤**ï¼šå°†å‘˜å·¥çŠ¶æ€è®¾ä¸ºç¦»èŒï¼Œè¯¥å‘˜å·¥å°è¯•ç™»å½•æˆ–åˆ·æ–°é¡µé¢
- **é¢„æœŸ**ï¼šToken å¤±æ•ˆæˆ–æ¥å£è¿”å› 403

### ğŸŸ¢ ä½ä¼˜å…ˆçº§

**ç”¨ä¾‹5ï¼šæŠ¥è¡¨æ—¥æœŸå¿«æ·é€‰æ‹©**
- **æ­¥éª¤**ï¼šç‚¹å‡» "æœ¬æœˆ"ã€"ä¸Šæœˆ"
- **é¢„æœŸ**ï¼šæ—¥æœŸèŒƒå›´æ§ä»¶æ­£ç¡®æ›´æ–°

## å››ã€ä»£ç ç¤ºä¾‹ (é’ˆå¯¹ Login ä¿®å¤ä¸æµ‹è¯•)

```typescript
// å»ºè®®ä¿®å¤ Login.tsx
const [agreed, setAgreed] = useState(false);

const handleLogin = async (e: React.FormEvent) => {
  e.preventDefault();
  if (!agreed) {
    // Show error
    return;
  }
  // ...
};

// å»ºè®®è¡¥å……æµ‹è¯• Login.test.tsx
describe('Login Page', () => {
  it('should prevent login if terms not agreed', async () => {
    render(<Login />);
    const loginBtn = screen.getByRole('button', { name: /ç™»å½•/i });
    
    // Fill form
    await userEvent.type(screen.getByPlaceholderText(/æ‰‹æœºå·/i), '186...');
    await userEvent.type(screen.getByPlaceholderText(/å¯†ç /i), 'pass...');
    
    // Click login without checking terms
    await userEvent.click(loginBtn);
    
    // Expect no api call and error message
    expect(mockLogin).not.toHaveBeenCalled();
    expect(screen.getByText(/è¯·å…ˆé˜…è¯»å¹¶åŒæ„/i)).toBeInTheDocument();
  });
});
```

## äº”ã€æ€»ç»“

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| å‘ç°ç›²åŒºæ€»æ•° | 5 (Loginåè®®, é”™è¯¯åé¦ˆ, æƒé™è¾¹ç•Œ, æ’ç­è¾¹ç•Œ, æŒä¹…åŒ–) |
| é«˜ä¼˜å…ˆçº§ | 3 |
| ä¸­ä¼˜å…ˆçº§ | 1 |
| é¢„è®¡è¡¥å……ç”¨ä¾‹æ•° | 5+ |
