# 班次删除失败修复记录

## 问题描述
- **现象**：前端删除班次 8 时报错 `net::ERR_ABORTED http://localhost:5173/api/v1/attendance/shifts/8`，界面提示“删除失败”。
- **复现步骤**：
  1. 访问班次管理页面
  2. 点击 ID 为 8 的班次删除按钮
  3. 确认删除
- **影响范围**：班次管理模块删除功能

## 设计锚定
- **所属规格**：SW64 班次管理
- **原设计意图**：
  - 后端 API 运行在 3001 端口
  - 删除班次前必须检查关联数据（排班表、每日考勤）
  - 若有关联数据，禁止删除并返回 409 Conflict
- **当前偏离**：
  1. 后端服务未启动，导致前端代理请求失败（ERR_ABORTED）
  2. 即使服务启动，该班次因被引用也无法删除（符合设计）

## 根因分析
- **直接原因**：后端服务器未运行，端口 3001 无监听，导致前端 Vite 代理连接拒绝。
- **根本原因**：
  1. 服务未启动。
  2. 业务逻辑层面，Shift 8 被排班表（attSchedule）引用，无法删除。
- **相关代码**：
  - `packages/server/src/modules/attendance/attendance-shift.service.ts`: 关联检查逻辑
  - `packages/web/vite.config.ts`: 代理配置

## 修复方案
- **修复思路**：
  1. 启动后端服务恢复 API 访问。
  2. 验证班次引用情况，明确无法删除的原因。
- **操作记录**：
  1. 执行 `npm run dev` 启动后端服务（端口 3001）。
  2. 运行诊断脚本确认 Shift 8 在 `attSchedule` 表中有 1 条引用记录。

## 验证结果
- [x] 后端服务已启动（端口 3001 LISTENING）
- [x] 诊断脚本确认 Shift 8 存在且被引用
- [x] 确认删除失败符合业务规则（应返回 409 而非网络错误）

## 后续建议
- 用户需先删除关联的排班记录，才能删除该班次。
