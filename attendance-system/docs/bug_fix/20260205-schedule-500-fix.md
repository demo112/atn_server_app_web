# 排班添加报错 500 修复记录

## 问题描述
- **现象**：用户在添加排班时，前端收到 500 错误。
- **复现步骤**：在前端排班弹窗中提交排班，若日期格式无效或为空，触发后端异常。
- **影响范围**：排班管理模块 (SW65)

## 设计锚定
- **所属规格**：SW65
- **原设计意图**：支持严格模式和覆盖模式的排班创建。
- **当前偏离**：后端缺乏对日期有效性的基础校验，导致无效日期透传至 ORM 层引发异常。

## 根因分析
- **直接原因**：`ScheduleService` 在接收到前端传递的日期字符串后，直接 `new Date()` 但未检查是否为 `Invalid Date`。
- **根本原因**：输入验证不足，依赖 ORM 层的错误抛出，且未被正确捕获为 400 错误。
- **相关代码**：`packages/server/src/modules/attendance/schedule/schedule.service.ts`

## 修复方案
- **修复思路**：在 Service 层入口处显式检查日期对象的有效性。
- **改动文件**：
  - `packages/server/src/modules/attendance/schedule/schedule.service.ts`

## 验证结果
- [x] 原问题已解决：无效日期将返回 400 错误 (ERR_INVALID_DATE)。
- [x] 代码逻辑检查：通过 `isNaN(date.getTime())` 准确判断无效日期。
- [x] 设计一致性确认：未改变 API 契约，仅增强健壮性。

## 文档同步
- [ ] design.md：不需要更新
- [ ] api-contract.md：不需要更新

## 提交信息
fix(attendance): 修复排班添加时的 500 错误

背景: 无效日期导致后端异常
变更: 增加日期有效性校验
影响: 排班创建接口
