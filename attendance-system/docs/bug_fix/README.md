# Bug 修复记录

本目录存放所有 bug 修复的记录文档。

## 命名规范

```
{YYYYMMDD}-{问题简述}-fix.md
```

示例：
- `20260204-login-error-fix.md`
- `20260205-shift-calc-fix.md`

## 文档模板

每个修复记录应包含：

1. **问题描述**：现象、复现步骤、影响范围
2. **设计锚定**：所属规格、原设计意图、偏离点
3. **根因分析**：直接原因、根本原因、相关代码
4. **修复方案**：修复思路、改动文件
5. **关联组件**：同类组件清单及同步状态（🔴 新增）
6. **验证结果**：验证清单
7. **防回退标记**：关键词、设计决策（🔴 新增）
8. **文档同步**：是否需要同步其他文档

## 🔴 防回退机制（重要）

### 修复前必须检查

在开始修复前，**必须搜索本目录**，检查是否有相关的历史修复：

```bash
grep -r "关键词" docs/bug_fix/
```

| 检查结果 | 处理 |
|----------|------|
| 发现相关修复 | **必须阅读**，理解之前的设计决策 |
| 与历史修复冲突 | **暂停**，询问用户确认需求 |

### 防回退标记

每个修复记录必须包含：

```markdown
## 防回退标记
**关键词**：部门树、根节点、虚拟根
**设计决策**：部门树必须包含虚拟根节点"全公司"
```

### 常见回退场景

| 场景 | 原因 | 预防措施 |
|------|------|----------|
| 弹窗反复添加/移除 | 需求理解不一致 | 修复前确认需求 |
| 组件修复不同步 | 同类组件未检查 | 列出关联组件清单 |
| 接口适配被覆盖 | 后续修改未考虑 | 在防回退标记中说明 |

## 与 features 文档的关系

- 修复记录先在此目录创建
- 如果修复涉及设计变更，需同步更新 `features/{SPEC_ID}/design.md`
- 如果修复涉及 API 变更，需同步更新 `api-contract.md`

## 关联组件索引

为便于查找同类组件的修复记录，维护以下索引：

| 组件类型 | 相关修复记录 |
|----------|--------------|
| 部门树 | `20260205-dept-tree-root-fix.md`, `20260205-department-tree-real-data-fix.md` |
| 统计报表弹窗 | `20260205-dailystats-range-refactor.md`, `20260206-monthly-summary-recalc-fix.md` |
| 班次下拉 | `20260206-batch-schedule-empty-shifts-fix.md` |
