# 补录打卡 404 错误修复记录

## 问题描述
- **现象**：前端发起补录打卡请求时，控制台报错 `AxiosError: Request failed with status code 404`。
- **复现步骤**：
  1. 在 Web 端进入考勤打卡页面。
  2. 点击"补录打卡"。
  3. 填写表单并提交。
  4. 观察控制台报错。
- **影响范围**：开发环境下的所有 API 请求（不仅仅是打卡）。

## 设计锚定
- **所属规格**：SW69 (考勤打卡)
- **原设计意图**：Web 端通过 `/api` 代理转发请求到后端 Server。
- **当前偏离**：
  - Server 默认端口为 3000（`index.ts`）。
  - Vite 代理默认配置假设 Server 在 3001（`vite.config.ts`）。
  - 当 `.env` 文件缺失时，两者使用不同的默认端口，导致代理失败。

## 根因分析
- **直接原因**：Vite Dev Server 无法连接到后端服务（或连接到错误的端口）。
- **根本原因**：
  1. 后端服务未启动，或启动端口与前端代理配置不一致。
  2. `packages/web/vite.config.ts` 中的默认端口 (3001) 与 `packages/server/src/index.ts` 中的默认端口 (3000) 不匹配。
  3. 开发环境缺失 `packages/server/.env` 文件，触发了上述默认值不一致的问题。

## 修复方案
- **修复思路**：统一前后端的默认端口配置，并确保后端服务正常启动。
- **改动文件**：
  - `packages/web/vite.config.ts`: 将默认端口从 3001 修改为 3000。
- **环境操作**：
  - 显式指定端口 3000 启动后端服务。

## 关联组件
| 组件 | 文件路径 | 是否同步修复 |
|------|----------|--------------|
| 所有 API Service | `packages/web/src/services/*.ts` | ✅ (通过全局配置修复) |

## 验证结果
- [x] **API 连通性**：访问 `http://localhost:3000/api/v1/attendance/clock` 返回 401 (鉴权错误) 而非 404，证明服务可达。
- [x] **回归测试**：前端代理配置已指向 3000。
- [x] **编译通过**：无代码编译错误。

## 防回退标记
**关键词**：端口不匹配、Vite Proxy、404
**设计决策**：开发环境默认端口统一使用 3000。

## 提交信息
fix(web): 修复开发环境API代理端口不匹配导致的404错误

背景: Server默认端口为3000，但Vite默认代理到3001
变更: 将Vite配置中的Server默认端口修正为3000
影响: 解决所有API请求在无env文件时的404问题
