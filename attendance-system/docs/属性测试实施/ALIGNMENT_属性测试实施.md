# ALIGNMENT - 属性测试实施 (Web端)

## 1. 项目上下文分析
- **项目结构**: Monorepo (pnpm workspace)
- **目标模块**: `packages/web` (Web管理端)
- **技术栈**: React, TypeScript, Vite, Ant Design, Vitest
- **当前状态**:
  - 基础测试框架已就绪 (`vitest`, `@testing-library/react`).
  - 尚未安装属性测试工具 (`fast-check` 缺失).
  - 现有测试主要为组件测试和少量单元测试.
- **业务特点**: 
  - 管理端涉及大量表单验证、数据转换、复杂筛选和报表计算.
  - 使用 `dayjs` 处理时间，容易出现时区或边界问题.
  - 使用 `zod` 进行 Schema 验证，天然适合属性测试生成数据.

## 2. 属性测试需求理解
- **目标**: 为 Web 端核心逻辑引入属性测试覆盖.
- **适用场景**:
  1. **纯函数工具 (Utils)**: 格式化、数据转换、计算逻辑.
  2. **自定义 Hooks**: 状态机逻辑、复杂交互逻辑.
  3. **表单验证**: 验证 Zod Schema 的健壮性.
  4. **通用组件**: 基础 UI 组件的 Props 组合测试.
- **痛点**:
  - 前端逻辑日益复杂，手动编写用例难以覆盖所有输入组合 (如特殊字符、极大数字、极端日期).
  - "测不准"的偶发 Bug 难以复现.

## 3. 智能决策与风险评估
- **工具选择**: `fast-check` (JavaScript/TypeScript 生态事实标准).
- **实施策略**:
  - **Phase 1 (原子层)**: 覆盖 `src/utils` 和纯逻辑 `hooks`.
  - **Phase 2 (验证层)**: 结合 `zod` schema 自动生成测试数据验证表单逻辑.
  - **Phase 3 (交互层)**: (暂缓) 组件级属性测试成本较高，初期不建议大规模通过 PBT 测试 UI 渲染.
- **风险**:
  - **性能影响**: 前端测试通常在 CI 运行，大量 PBT 可能拖慢构建. -> *对策: 限制默认运行次数 (numRuns: 100)*.
  - **Dom 依赖**: 涉及 Dom 的测试不稳定. -> *对策: 剥离逻辑到纯函数测试*.

## 4. 关键决策点 (待确认)
- **范围**: 仅限 `packages/web`.
- **工具**: 确认引入 `fast-check`.
- **优先级**: Utils > Hooks > Form Validation.
- **集成**: 集成到现有的 `npm run test` 命令中.
