# ALIGNMENT - 属性测试实施

## 1. 项目上下文分析
- **项目结构**: Monorepo (pnpm workspace)
- **技术栈**: Node.js, Express, TypeScript, Prisma, Vitest
- **当前状态**:
  - `packages/server` 包含核心业务逻辑。
  - 依赖中已包含 `fast-check`，说明团队有属性测试意识或意愿。
  - 现有测试包含单元测试、集成测试、契约测试和少量模糊测试，但缺乏系统性的属性测试覆盖。
- **业务特点**: 考勤系统包含大量时间计算、状态流转、排班算法，非常适合属性测试（如时间重叠、班次计算的不变量）。

## 2. 属性测试需求理解
- **目标**: 对后台全部逻辑进行全属性测试覆盖。
- **痛点**: 
  - 传统单元测试难以覆盖所有时间边界组合。
  - 复杂的排班和考勤计算逻辑容易在边缘情况下出错。
  - 需要一种方法来验证系统的不变量（Invariants）。
- **预期效果**:
  - 发现隐藏的边界 Bug。
  - 提高核心算法的健壮性。
  - 作为现有测试体系的有力补充。

## 3. 智能决策与风险评估
- **工具选择**: `fast-check` (已安装，TypeScript 生态最佳选择)。
- **实施策略**: 
  - 鉴于“全属性测试覆盖”是一个宏大的目标，不能一蹴而就。
  - 必须采用**分层渐进**策略，优先覆盖高风险、高复杂度的核心模块。
- **潜在风险**:
  - **编写难度**: 定义有效的 Property 比编写 Example-based 测试更难。
  - **执行时间**: 属性测试运行时间较长，可能影响 CI 速度。
  - **学习曲线**: 团队需要学习 PBT 思维。

## 4. 关键决策点 (已确认)
- **范围**: Server 端全部逻辑。
- **工具**: 保持使用 `fast-check`。
- **集成**: 集成到现有的 `vitest` 流程中。
