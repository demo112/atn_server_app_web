# Requirements: 考勤明细 (SW71)

## Overview

考勤明细功能允许管理员和员工查询每日的考勤结果（如迟到、早退、缺勤、加班等）。这是考勤系统的核心查询功能，用于核对考勤数据的准确性，并支持管理员在发现数据异常时手动触发重新计算。

## User Stories

### Story 1: 管理员查询考勤明细 (Web)

As a 管理员, I want 在Web管理后台查询所有员工的每日考勤记录, so that 核对考勤异常和处理员工申诉

**Acceptance Criteria:**
- [ ] AC1: 支持按时间范围（开始日期-结束日期）筛选
- [ ] AC2: 支持按部门筛选（递归包含子部门）
- [ ] AC3: 支持按员工姓名/工号搜索
- [ ] AC4: 支持按考勤状态筛选（正常/迟到/早退/缺勤等）
- [ ] AC5: 列表显示：日期、姓名、部门、班次、打卡时间、考勤状态、迟到/早退时长
- [ ] AC6: 支持分页查询

### Story 2: 员工查询个人考勤明细 (Web)

As a 员工, I want 在Web端查看自己的考勤记录, so that 确认我的出勤情况

**Acceptance Criteria:**
- [ ] AC1: 默认只显示当前登录用户的记录
- [ ] AC2: 支持按日期范围筛选
- [ ] AC3: 界面展示与管理员一致，但无权查看他人数据

### Story 3: 员工查看考勤日历 (App)

As a 员工, I want 在手机App上以日历形式查看考勤状态, so that 直观了解每月的出勤情况

**Acceptance Criteria:**
- [ ] AC1: 日历视图展示每日考勤状态点（正常🟢/异常🔴/请假🔵）
- [ ] AC2: 点击日期显示当天的详细打卡时间和考勤结果
- [ ] AC3: 支持切换月份

### Story 5: 管理员查询考勤明细 (App)

As a 管理员, I want 在手机App上查询员工考勤记录, so that 移动办公时也能核对考勤

**Acceptance Criteria:**
- [ ] AC1: 入口：管理员工作台 -> 考勤明细
- [ ] AC2: 筛选：支持按部门、日期范围筛选
- [ ] AC3: 搜索：支持按姓名搜索
- [ ] AC4: 列表展示：卡片式布局，展示关键信息（姓名、日期、状态、时间）
- [ ] AC5: 支持下拉刷新和上拉加载更多

### Story 4: 手动重算考勤

As a 管理员, I want 手动触发指定员工和日期的考勤重算, so that 修正因排班调整或补卡产生的历史数据错误

**Acceptance Criteria:**
- [ ] AC1: 可以在明细页面选择特定记录触发"重新计算"
- [ ] AC2: 支持批量选择多条记录进行重算
- [ ] AC3: 重算完成后自动刷新列表显示最新状态

## Constraints

- **权限控制**：普通员工只能看自己的数据，管理员/部门负责人可看管辖范围内的数据。
- **性能要求**：查询响应时间 < 1秒（数据量大时需优化索引）。
- **数据一致性**：重算操作必须原子化，确保结果与当前规则一致。

## Out of Scope

- 考勤申诉流程（这是下一阶段的功能）
- 复杂的排班调整（本功能只负责基于现有排班重算）
- 报表导出（属于 SW72）

## Assumptions

以下假设已与用户确认：
- 考勤数据来源为 `AttDailyRecord` 表
- 每日考勤结果已由定时任务计算生成，本功能主要做查询和按需重算
- `BigInt` 类型的 ID 在前端需要转为 String 处理

## Metadata

- 规模：中
- 涉及模块：statistics (查询), attendance (重算)
- 涉及端：Server, Web, App
- 创建时间：2026-02-03
- 状态：已确认
