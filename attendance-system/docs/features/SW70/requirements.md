# Requirements: SW70 考勤汇总

## Overview

考勤汇总模块用于展示员工在指定时间段内的考勤统计结果。
为了保证查询性能，系统采用**“定时预计算 + 查询结果表”**的模式：每天在指定时间（用户可配置，如凌晨 5:00）自动计算前一天的考勤汇总并存储。管理员查看时直接读取预计算的结果。

## User Stories

### Story 1: 查看部门考勤汇总

As a 管理员, I want 查看指定部门和时间段的考勤汇总列表, so that 了解员工的整体出勤表现

**Acceptance Criteria:**
- [ ] AC1: 支持按“部门”筛选（包含子部门员工）
- [ ] AC2: 支持按“日期范围”筛选（开始日期~结束日期）
- [ ] AC3: 数据来源于预计算的汇总表，查询响应时间 < 1秒
- [ ] AC4: 列表展示字段：工号、姓名、部门、应出勤天数、实际出勤天数、迟到次数/时长、早退次数/时长、缺勤天数、请假时长
- [ ] AC5: 若查询当天（未结转）的数据，提示数据截止到昨日或显示实时估算（本次仅实现查询截止昨日的已归档数据）

### Story 2: 自动定时计算 (System)

As a 系统, I want 每天在指定时间自动计算所有员工的昨日考勤汇总, so that 保证汇总数据的及时性和一致性

**Acceptance Criteria:**
- [ ] AC1: 读取考勤规则配置的“自动计算时间”（如 05:00）
- [ ] AC2: 自动触发计算任务，遍历所有在职员工
- [ ] AC3: 计算结果存入 `AttDailySummary` 表
- [ ] AC4: 任务执行需记录日志（开始时间、结束时间、成功/失败数量）

### Story 3: 导出考勤汇总

As a HR, I want 将考勤汇总数据导出为Excel, so that 进行线下的薪资核算

**Acceptance Criteria:**
- [ ] AC1: 点击“导出”按钮，下载当前筛选条件下的汇总报表
- [ ] AC2: 导出文件格式为 Excel (.xlsx)

### Story 4: 跳转查看明细

As a 管理员, I want 点击某员工的汇总记录跳转到每日明细, so that 查看具体的异常情况

**Acceptance Criteria:**
- [ ] AC1: 列表中的“姓名”或操作列提供“查看明细”链接
- [ ] AC2: 点击跳转到考勤明细页面（SW71）

## Constraints

- **性能要求**: 列表查询需在 1秒内 返回
- **数据一致性**: 汇总数据一旦生成，除非手动触发重算（本阶段Out of Scope），否则保持不变

## Out of Scope

- **手动重算**: 本阶段不支持手动触发重新计算某段时间的汇总
- **实时汇总**: 不支持查看“今天”的实时汇总变化
- **移动端展示**: 目前仅实现 Web 端

## Assumptions

以下假设已与用户确认：
- 考勤规则 (SW62) 将提供 `auto_calc_time` 配置项
- 每日考勤明细 (`att_daily_records`) 在计算时间点前已由 Naruto 负责的模块生成完毕
- 系统需引入任务调度机制 (BullMQ)

## Metadata

- 规模：中
- 涉及模块：server (statistics, attendance), web (report)
- 涉及端：Web
- 创建时间：2026-02-02
- 状态：已修改 (转为定时计算)
