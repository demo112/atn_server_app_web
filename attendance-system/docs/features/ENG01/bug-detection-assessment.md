# ENG01 系统对当前 Bug 的发现能力评估报告

基于对 `docs/features/ENG01` 文档的分析及两批日志内容的综合研判，以下是关于“这套系统能否发现这些 Bug”的详细评估：

## 1. 核心结论

**简短回答：**
- **在开发/构建阶段 (CI/CD)**：**部分能**（取决于测试策略）。
  - **能发现**：前端逻辑错误、组件渲染崩溃（通过集成测试）、Lint 错误。
  - **不能发现**：后端服务崩溃 (500)、前后端契约不一致（Mock 数据掩盖了真实结构差异）。
- **在运行时阶段 (Runtime)**：**能**。
  - ENG01 引入的 **统一日志规范 (Governance)** 和 **Logger 工具 (Infrastructure)** 正在高效工作。它不仅捕获了网络错误，还通过 Zod 拦截了数据结构错误，避免了页面白屏。

## 2. 详细分析：ENG01 对不同 Bug 的拦截能力

| Bug 类型 | 日志示例 | ENG01 (运行时) | ENG01 (CI/测试) | 原因分析 |
|:---|:---|:---:|:---:|:---|
| **数据契约错误** | `ZodError: [` | ✅ **拦截成功** | ❌ **漏测** | **运行时**：Governance 层引入的 Zod 校验成功拦截了脏数据，防止了 UI 崩溃。<br>**测试时**：前端测试使用 MSW Mock 数据（通常是“完美”的），无法模拟真实后端返回了不符合 Schema 的数据。 |
| **后端崩溃 (500)** | `Failed to load records (500)` | ✅ **捕获成功** | ❌ **漏测** | **运行时**：Logger 记录了完整的错误堆栈。<br>**测试时**：单元/集成测试不连接真实后端，Mock 返回 200 OK，掩盖了服务端故障。 |
| **依赖兼容性** | `Warning: [antd: compatible]` | ✅ **控制台可见** | ⚠️ **可能漏测** | **运行时**：浏览器控制台输出警告。<br>**测试时**：除非在 `setupTests.ts` 中配置了“将 console.warn 视为失败”，否则构建流水线通常会忽略警告。 |
| **参数错误 (400)** | `Schedule creation failed (400)` | ✅ **捕获成功** | ❌ **漏测** | **运行时**：捕获了请求错误。<br>**测试时**：Happy Path 测试只覆盖正确参数。除非特意编写了“后端校验失败”的 Mock 场景，否则无法发现。 |

## 3. ENG01 的价值体现

虽然 CI 阶段有漏测，但 **ENG01 体系在运行时表现出色**：
1.  **Zod 带来的防御性编程**：`ZodError` 的出现证明了系统具有了“自我免疫”能力。如果没有它，这些数据结构错误可能会导致更严重的 `Cannot read property of undefined` 页面白屏，排查难度将呈指数级上升。
2.  **统一日志的排查效率**：所有错误都通过 `utils/logger.ts` 统一输出，格式规范，位置明确，极大地降低了排查成本。

## 4. 改进建议 (Next Steps)

为了将拦截前移到 CI/CD 阶段，建议：

1.  **推进 S2 后端契约测试 (High Priority)**
    *   **目标**：确保后端 API 的变动会触发前端类型检查失败。
    *   **方案**：基于 Zod Schema 自动生成 OpenAPI 文档或契约测试用例，在后端 CI 中运行。

2.  **引入 E2E 冒烟测试 (High Priority)**
    *   **目标**：拦截 500 服务不可用错误。
    *   **方案**：在部署前运行少量 Cypress/Playwright 用例，连接**真实**的 Staging 后端，覆盖“登录 -> 首页 -> 核心列表”路径。

3.  **强化依赖检查**
    *   **目标**：消除版本兼容性警告。
    *   **方案**：配置 `strict-peer-dependencies` 或在测试配置中将 `console.warn` 提升为错误。
